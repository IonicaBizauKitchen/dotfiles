{"mode":"editor","version":1,"windowDimensions":{"x":0,"y":22,"width":1440,"height":874},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"path":"/Users/zeke/code/heroku-examples/geosockets","buffers":[{"text":"ws = require('ws').Server\nhttp = require 'http'\nexpress = require 'express'\ncookie = require 'cookie-cutter'\nUserStore = require('./lib/user-store')\n\nmodule.exports = ->\n\n  # Abstracted Redis Store\n  @UserStore = new UserStore()\n\n  # Express App (Static Frontend)\n  @app = express()\n  @app.configure =>\n    @app.use @app.router\n    @app.use '/', express.static('public')\n\n  # HTTP Server\n  @server = http.createServer(@app)\n  @server.listen(process.env.PORT or 5000)\n\n  # Websockets Server\n  @socketServer = new ws(server: @server)\n  @socketServer.on \"connection\", (socket) =>\n    socket.on 'message', (data, flags) =>\n      user = JSON.parse(data)\n      console.log user\n      @UserStore.add user, (err, users) ->\n        return console.error(err) if err\n        @UserStore.getByUrl user.url, (err, users) ->\n          return console.error(err) if err\n          for client in @socketServer.clients\n            client.send JSON.stringify(users)\n\n  # Return app for testability\n  @app","markers":{"markers":{"1":{"id":1,"range":[[31,25],[31,37]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":67,"goalBufferRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"filePath":"/Users/zeke/code/heroku-examples/geosockets/server.coffee","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"bc77f7d8fa0b6f345035277312a7ca5e2746fe4d","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"items":[{"id":67,"softTabs":true,"displayBuffer":{"id":68,"softWrap":false,"editorWidthInChars":110,"scrollTop":45,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/zeke/code/heroku-examples/geosockets/server.coffee","tabLength":2,"deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"Editor"}],"activeItemUri":"/Users/zeke/code/heroku-examples/geosockets/server.coffee","focused":true,"active":true,"deserializer":"Pane"},"deserializer":"PaneContainer"},"fullScreen":false,"deserializer":"Workspace"},"packageStates":{"fuzzy-finder":{"/Users/zeke/code/heroku-examples/geosockets/server.coffee":1401644703087},"keybinding-resolver":{"attached":false},"metrics":{"sessionLength":82577285},"tree-view":{"directoryExpansionStates":{"lib":{}},"selectedPath":"/Users/zeke/code/heroku-examples/geosockets/server.coffee","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200},"script":{"scriptOptionsViewState":""}}}